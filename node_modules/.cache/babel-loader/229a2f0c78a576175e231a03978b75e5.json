{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\97252\\\\Documents\\\\Projects\\\\river\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";/*global chrome*/import\"./App.css\";import NumberInput from\"./components/NumberInput\";import Timer from\"./components/Timer\";import BufferElement from\"./components/BufferElement\";import AnimatedProgressBar from\"./components/AnimatedProgressBar\";import{useState,useEffect,useReducer,useRef}from\"react\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var playFile=function playFile(filepath){var audioPlayer=new Audio(chrome.runtime.getURL(filepath));audioPlayer.play();};function App(){// ETA Mode (Forward Looking),\n// Sequential Mode (Time Elapsed)\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),isBuffering=_useState2[0],setIsBuffering=_useState2[1];var isInInitialization=useRef(true);// to signal to the buffer not to load while first initializing\nvar isBufferingRef=useRef(false);isBufferingRef.current=isBuffering;var designDigit=function designDigit(num){return+num<10?\"0\"+num:num;};var destructureSeconds=function destructureSeconds(time){time=Math.round(time);// round time received in seconds\nvar sec=designDigit(time%60);var min=designDigit((time-sec)/60%60);var hr=(time-sec-60*min)/3600;return[hr,min,sec];};var beautify=function beautify(time){var _destructureSeconds=destructureSeconds(time),_destructureSeconds2=_slicedToArray(_destructureSeconds,3),hr=_destructureSeconds2[0],min=_destructureSeconds2[1],sec=_destructureSeconds2[2];return\"\".concat(hr,\"h\").concat(min,\"m\").concat(sec,\"s\");};var filterInput=function filterInput(newInput,oldInput){var _ref;if(((_ref=newInput+\"\")===null||_ref===void 0?void 0:_ref.trim())===\"\"){return 0;}return Number.isInteger(+newInput)?+newInput:+oldInput;};var dataReducer=function dataReducer(state,action){var newVal;if(action.type===\"USER_INITIALIZE\"){return{start:filterInput(action.start,undefined),current:filterInput(action.current,undefined),end:filterInput(action.end,undefined),time:action.time,total:action.total,timerID:state.timerID};}else if(action.type===\"DATA_REFRESH\"){return{start:action.start,current:action.progress,end:action.end,total:action.totalSeconds,time:state.time,timerID:state.timerID};}else if(action.type===\"USER_ADDTIME\"){chrome.storage.sync.set({startedRecordingAt:null,savedTime:+state.time+action.value});return{start:state.start,current:state.current,end:state.end,time:+state.time+action.value,total:state.total,timerID:state.timerID};}else if(action.type===\"START_CHANGE\"){newVal=filterInput(+action.value,+state.start);return{start:newVal,current:newVal>+state.current?newVal:+state.current,end:newVal>+state.end?newVal:state.end,time:state.time,total:state.total,timerID:state.timerID};}else if(action.type===\"CURRENT_CHANGE\"){newVal=filterInput(+action.value,+state.current);return{start:newVal<+state.start?newVal:+state.start,current:newVal,end:newVal>+state.end?newVal:+state.end,time:state.time,total:state.total,timerID:state.timerID};}else if(action.type===\"END_CHANGE\"){newVal=filterInput(+action.value,+state.end);return{start:newVal<+state.start?newVal:state.start,current:newVal<+state.current?newVal:state.current,end:newVal,time:state.time,total:state.total,timerID:state.timerID};}else if(action.type===\"TOTAL_UPDATE\"){// <----------- deprecated completely\nthrow new Error();}else if(action.type===\"TIME_RESET\"){var accumulatedTime=state.total+state.time;clearInterval(state.timerID);chrome.storage.sync.set({startedRecordingAt:null,savedTime:null,totalSeconds:accumulatedTime});return{start:state.start,current:state.current,end:state.end,time:null,total:accumulatedTime,timerID:false};}else if(action.type===\"FULL_RESET\"){var _accumulatedTime=state.total+state.time;clearInterval(state.timerID);chrome.storage.sync.set({startedRecordingAt:null,savedTime:null,totalSeconds:_accumulatedTime});return{start:0,current:0,end:0,time:null,total:_accumulatedTime,timerID:false};}else if(action.type===\"MODIFY_TIMERID\"){chrome.storage.sync.get([\"startedRecordingAt\"],function(data){if(data.startedRecordingAt===null){chrome.storage.sync.set({startedRecordingAt:Date.now()-+state.time*1000,savedTime:null});}});return{start:state.start,current:state.current,end:state.end,time:null,total:state.total,timerID:action.value};}else if(action.type===\"TIME_START\"){throw new Error();// this area is now deprecated!\n}else if(action.type===\"TIME_PAUSE\"){var newTime=null;clearInterval(state.timerID);if(action.value!==null){newTime=(Date.now()-action.value)/1000;chrome.storage.sync.set({startedRecordingAt:null,savedTime:newTime});}return{start:state.start,current:state.current,end:state.end,time:newTime,total:state.total,timerID:false};}};var _useReducer=useReducer(dataReducer,{start:null,current:null,end:null,time:null,total:null,timerID:false}),_useReducer2=_slicedToArray(_useReducer,2),dataState=_useReducer2[0],dataDispatch=_useReducer2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),getUserName=_useState4[0],setUserName=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),timeToShow=_useState6[0],setTimeToShow=_useState6[1];// it's false here to suit the JSX element later\nuseEffect(function(){if(dataState.timerID===false){if(dataState.time>0){setTimeToShow(dataState.time);}else{setTimeToShow(false);}}else{chrome.storage.sync.get([\"startedRecordingAt\"],function(data){if(data.startedRecordingAt!==null){setTimeToShow((Date.now()-data.startedRecordingAt)/1000);}});}},[dataState.timerID,dataState.time]);useEffect(function(){// initialize some variables from chrome storage\nchrome.storage.sync.get([\"startedRecordingAt\",\"savedTime\",\"start\",\"progress\",\"end\",\"userName\",\"totalSeconds\"],function(data){dataDispatch({type:\"USER_INITIALIZE\",time:data.startedRecordingAt===null// check if a recording is in progress\n?data.savedTime===null?null:data.savedTime:null,start:data.start,current:data.progress,end:data.end,total:data.totalSeconds});setUserName(data.userName);isInInitialization.current=false;});},[]);useEffect(function(){// update variables in a debounced way (to avoid going over the 1800 MAX_WRITE_OPERATIONS / hr)\nvar delayedUpdate;if(!isInInitialization.current){// don't write back values on first initializating\nif(dataState.end===dataState.current&&dataState.end!==dataState.start){playFile(\"sounds/complete.mp3\");chrome.storage.sync.get([\"startedRecordingAt\"],function(data){dataDispatch({type:\"TIME_PAUSE\",value:data.startedRecordingAt});});}else if(dataState.start!==dataState.current&&dataState.end!==dataState.start){playFile(\"sounds/increment.mp3\");}delayedUpdate=setTimeout(function(){chrome.storage.sync.set({start:dataState.start,progress:dataState.current,end:dataState.end},function(){setIsBuffering(false);});},2000);// add buffering\nsetIsBuffering(true);}return function(){clearTimeout(delayedUpdate);};},[dataState.start,dataState.current,dataState.end]);var timeAddHandler=function timeAddHandler(){if(dataState.timerID!==false){alert(\"Can't proceed while timer is active.\");return;}var x=prompt(\"Enter amount of time to load in the following format: h:mm:ss\");if(x!==undefined&&x!==null){var timeArr=x===null||x===void 0?void 0:x.split(\":\").reverse();if((timeArr===null||timeArr===void 0?void 0:timeArr.length)!==3){alert(\"Invalid input! Too many or too few fields were input.\");return;}if(!Number.isInteger(+timeArr[0])||!Number.isInteger(+timeArr[1])||!Number.isInteger(+timeArr[2])){alert(\"Invalid input! All fields must be integers.\");return;}//All checks passed, now we're diving in to the addition.\nvar desiredTimeInSeconds=+timeArr[0]+ +timeArr[1]*60+ +timeArr[2]*3600;dataDispatch({type:\"USER_ADDTIME\",value:desiredTimeInSeconds});}};var nameChangeHandler=function nameChangeHandler(){var _prompt;var newUserName=(_prompt=prompt(\"Please choose your nickname:\"))===null||_prompt===void 0?void 0:_prompt.trim();if((newUserName===null||newUserName===void 0?void 0:newUserName.length)===0){alert(\"Invalid input! Name must contain at least one charachter.\");}else if(newUserName!==undefined&&newUserName!==null){setUserName(newUserName);chrome.storage.sync.set({userName:newUserName});}};var tickHandler=function tickHandler(){if(isBufferingRef.current===false){chrome.storage.sync.get([\"start\",\"progress\",\"end\",\"totalSeconds\",\"startedRecordingAt\"],function(data){dataDispatch({type:\"DATA_REFRESH\",start:data.start,progress:data.progress,end:data.end,totalSeconds:data.totalSeconds});setTimeToShow((Date.now()-data.startedRecordingAt)/1000// add 1 second to account for delay\n);});}};return/*#__PURE__*/_jsxs(\"div\",{id:\"popup-container\",className:\"Card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"Card-header\",children:[/*#__PURE__*/_jsx(\"a\",{onClick:nameChangeHandler,className:\"headline\",children:/*#__PURE__*/_jsx(\"b\",{children:getUserName})}),/*#__PURE__*/_jsx(\"a\",{onClick:timeAddHandler,className:\"mode\",children:\"Import Time\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"Card-layout\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"stats seperated datasection\",children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"b\",{children:\"Stats\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[\"You have in total \",/*#__PURE__*/_jsx(\"b\",{children:Math.round(dataState.total/3600)}),\" \",\"recorded hours.\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"initialize-data seperated datasection\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"data-row\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"Start\"}),/*#__PURE__*/_jsx(NumberInput,{min:0,className:\"data-input\",placeholder:\"0\",onChange:function onChange(event){dataDispatch({type:\"START_CHANGE\",value:event.target.value});},value:+dataState.start===0?\"\":dataState.start})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"data-row\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"Progress\"}),/*#__PURE__*/_jsx(NumberInput,{className:\"data-input\",placeholder:\"0\",onChange:function onChange(event){dataDispatch({type:\"CURRENT_CHANGE\",value:event.target.value});},value:+dataState.current===0?\"\":dataState.current})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"data-row\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"Finish\"}),/*#__PURE__*/_jsx(NumberInput,{className:\"data-input\",placeholder:\"0\",onChange:function onChange(event){dataDispatch({type:\"END_CHANGE\",value:event.target.value});},value:+dataState.end===0?\"\":dataState.end})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"actions datasection\"+(dataState.end>dataState.start?\" button-seperated\":\"\"),children:/*#__PURE__*/_jsxs(\"div\",{className:\"buttons-container\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return dataDispatch({type:\"TIME_RESET\"});},onDoubleClick:function onDoubleClick(){return dataDispatch({type:\"FULL_RESET\"});},children:\"Reset\"}),/*#__PURE__*/_jsx(BufferElement,{isActive:isBuffering,isInitializing:isInInitialization,timeDisplay:timeToShow!==false?beautify(timeToShow):timeToShow}),/*#__PURE__*/_jsx(Timer,{autoFocus:true,timerID:dataState.timerID,modifyTimerID:function modifyTimerID(newID){dataDispatch({type:\"MODIFY_TIMERID\",value:newID});},onTick:tickHandler,onPause:function onPause(){return chrome.storage.sync.get([\"startedRecordingAt\"],function(data){dataDispatch({type:\"TIME_PAUSE\",value:data.startedRecordingAt});});}})]})}),dataState.end>dataState.start?/*#__PURE__*/_jsx(\"div\",{className:\"progress-section prog-actions\",children:/*#__PURE__*/_jsx(AnimatedProgressBar,{progress:dataState.end-dataState.start===0?0:(dataState.current-dataState.start)/(dataState.end-dataState.start)})}):false]})]});}export default App;","map":{"version":3,"sources":["C:/Users/97252/Documents/Projects/river/src/App.js"],"names":["NumberInput","Timer","BufferElement","AnimatedProgressBar","useState","useEffect","useReducer","useRef","playFile","filepath","audioPlayer","Audio","chrome","runtime","getURL","play","App","isBuffering","setIsBuffering","isInInitialization","isBufferingRef","current","designDigit","num","destructureSeconds","time","Math","round","sec","min","hr","beautify","filterInput","newInput","oldInput","trim","Number","isInteger","dataReducer","state","action","newVal","type","start","undefined","end","total","timerID","progress","totalSeconds","storage","sync","set","startedRecordingAt","savedTime","value","Error","accumulatedTime","clearInterval","get","data","Date","now","newTime","dataState","dataDispatch","getUserName","setUserName","timeToShow","setTimeToShow","userName","delayedUpdate","setTimeout","clearTimeout","timeAddHandler","alert","x","prompt","timeArr","split","reverse","length","desiredTimeInSeconds","nameChangeHandler","newUserName","tickHandler","event","target","newID"],"mappings":"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","sourcesContent":["/*global chrome*/\r\nimport \"./App.css\";\r\nimport NumberInput from \"./components/NumberInput\";\r\nimport Timer from \"./components/Timer\";\r\nimport BufferElement from \"./components/BufferElement\";\r\nimport AnimatedProgressBar from \"./components/AnimatedProgressBar\";\r\nimport { useState, useEffect, useReducer, useRef } from \"react\";\r\n\r\nconst playFile = (filepath) => {\r\n  var audioPlayer = new Audio(chrome.runtime.getURL(filepath));\r\n  audioPlayer.play();\r\n};\r\n\r\nfunction App() {\r\n  // ETA Mode (Forward Looking),\r\n  // Sequential Mode (Time Elapsed)\r\n\r\n  const [isBuffering, setIsBuffering] = useState(false);\r\n  const isInInitialization = useRef(true); // to signal to the buffer not to load while first initializing\r\n  const isBufferingRef = useRef(false);\r\n\r\n  isBufferingRef.current = isBuffering;\r\n\r\n  const designDigit = (num) => (+num < 10 ? \"0\" + num : num);\r\n\r\n  const destructureSeconds = (time) => {\r\n    time = Math.round(time); // round time received in seconds\r\n\r\n    let sec = designDigit(time % 60);\r\n    let min = designDigit(((time - sec) / 60) % 60);\r\n    let hr = (time - sec - 60 * min) / 3600;\r\n\r\n    return [hr, min, sec];\r\n  };\r\n\r\n  const beautify = (time) => {\r\n    let [hr, min, sec] = destructureSeconds(time);\r\n\r\n    return `${hr}h${min}m${sec}s`;\r\n  };\r\n\r\n  const filterInput = (newInput, oldInput) => {\r\n    if ((newInput + \"\")?.trim() === \"\") {\r\n      return 0;\r\n    }\r\n    return Number.isInteger(+newInput) ? +newInput : +oldInput;\r\n  };\r\n\r\n  const dataReducer = (state, action) => {\r\n    let newVal;\r\n    if (action.type === \"USER_INITIALIZE\") {\r\n      return {\r\n        start: filterInput(action.start, undefined),\r\n        current: filterInput(action.current, undefined),\r\n        end: filterInput(action.end, undefined),\r\n        time: action.time,\r\n        total: action.total,\r\n        timerID: state.timerID,\r\n      };\r\n    } else if (action.type === \"DATA_REFRESH\") {\r\n      return {\r\n        start: action.start,\r\n        current: action.progress,\r\n        end: action.end,\r\n        total: action.totalSeconds,\r\n        time: state.time,\r\n        timerID: state.timerID,\r\n      };\r\n    } else if (action.type === \"USER_ADDTIME\") {\r\n      chrome.storage.sync.set({\r\n        startedRecordingAt: null,\r\n        savedTime: +state.time + action.value,\r\n      });\r\n      return {\r\n        start: state.start,\r\n        current: state.current,\r\n        end: state.end,\r\n        time: +state.time + action.value,\r\n        total: state.total,\r\n        timerID: state.timerID,\r\n      };\r\n    } else if (action.type === \"START_CHANGE\") {\r\n      newVal = filterInput(+action.value, +state.start);\r\n      return {\r\n        start: newVal,\r\n        current: newVal > +state.current ? newVal : +state.current,\r\n        end: newVal > +state.end ? newVal : state.end,\r\n        time: state.time,\r\n        total: state.total,\r\n        timerID: state.timerID,\r\n      };\r\n    } else if (action.type === \"CURRENT_CHANGE\") {\r\n      newVal = filterInput(+action.value, +state.current);\r\n      return {\r\n        start: newVal < +state.start ? newVal : +state.start,\r\n        current: newVal,\r\n        end: newVal > +state.end ? newVal : +state.end,\r\n        time: state.time,\r\n        total: state.total,\r\n        timerID: state.timerID,\r\n      };\r\n    } else if (action.type === \"END_CHANGE\") {\r\n      newVal = filterInput(+action.value, +state.end);\r\n      return {\r\n        start: newVal < +state.start ? newVal : state.start,\r\n        current: newVal < +state.current ? newVal : state.current,\r\n        end: newVal,\r\n        time: state.time,\r\n        total: state.total,\r\n        timerID: state.timerID,\r\n      };\r\n    } else if (action.type === \"TOTAL_UPDATE\") {\r\n      // <----------- deprecated completely\r\n      throw new Error();\r\n    } else if (action.type === \"TIME_RESET\") {\r\n      let accumulatedTime = state.total + state.time;\r\n\r\n      clearInterval(state.timerID);\r\n      chrome.storage.sync.set({\r\n        startedRecordingAt: null,\r\n        savedTime: null,\r\n        totalSeconds: accumulatedTime,\r\n      });\r\n      return {\r\n        start: state.start,\r\n        current: state.current,\r\n        end: state.end,\r\n        time: null,\r\n        total: accumulatedTime,\r\n        timerID: false,\r\n      };\r\n    } else if (action.type === \"FULL_RESET\") {\r\n      let accumulatedTime = state.total + state.time;\r\n\r\n      clearInterval(state.timerID);\r\n      chrome.storage.sync.set({\r\n        startedRecordingAt: null,\r\n        savedTime: null,\r\n        totalSeconds: accumulatedTime,\r\n      });\r\n      return {\r\n        start: 0,\r\n        current: 0,\r\n        end: 0,\r\n        time: null,\r\n        total: accumulatedTime,\r\n        timerID: false,\r\n      };\r\n    } else if (action.type === \"MODIFY_TIMERID\") {\r\n      chrome.storage.sync.get([\"startedRecordingAt\"], (data) => {\r\n        if (data.startedRecordingAt === null) {\r\n          chrome.storage.sync.set({\r\n            startedRecordingAt: Date.now() - +state.time * 1000,\r\n            savedTime: null,\r\n          });\r\n        }\r\n      });\r\n      return {\r\n        start: state.start,\r\n        current: state.current,\r\n        end: state.end,\r\n        time: null,\r\n        total: state.total,\r\n        timerID: action.value,\r\n      };\r\n    } else if (action.type === \"TIME_START\") {\r\n      throw new Error(); // this area is now deprecated!\r\n    } else if (action.type === \"TIME_PAUSE\") {\r\n      let newTime = null;\r\n      clearInterval(state.timerID);\r\n\r\n      if (action.value !== null) {\r\n        newTime = (Date.now() - action.value) / 1000;\r\n        chrome.storage.sync.set({\r\n          startedRecordingAt: null,\r\n          savedTime: newTime,\r\n        });\r\n      }\r\n\r\n      return {\r\n        start: state.start,\r\n        current: state.current,\r\n        end: state.end,\r\n        time: newTime,\r\n        total: state.total,\r\n        timerID: false,\r\n      };\r\n    }\r\n  };\r\n\r\n  let [dataState, dataDispatch] = useReducer(dataReducer, {\r\n    start: null,\r\n    current: null,\r\n    end: null,\r\n    time: null,\r\n    total: null,\r\n    timerID: false,\r\n  });\r\n\r\n  let [getUserName, setUserName] = useState(null);\r\n  let [timeToShow, setTimeToShow] = useState(false); // it's false here to suit the JSX element later\r\n\r\n  useEffect(() => {\r\n    if (dataState.timerID === false) {\r\n      if (dataState.time > 0) {\r\n        setTimeToShow(dataState.time);\r\n      } else {\r\n        setTimeToShow(false);\r\n      }\r\n    } else {\r\n      chrome.storage.sync.get([\"startedRecordingAt\"], (data) => {\r\n        if (data.startedRecordingAt !== null) {\r\n          setTimeToShow((Date.now() - data.startedRecordingAt) / 1000);\r\n        }\r\n      });\r\n    }\r\n  }, [dataState.timerID, dataState.time]);\r\n\r\n  useEffect(() => {\r\n    // initialize some variables from chrome storage\r\n    chrome.storage.sync.get(\r\n      [\r\n        \"startedRecordingAt\",\r\n        \"savedTime\",\r\n        \"start\",\r\n        \"progress\",\r\n        \"end\",\r\n        \"userName\",\r\n        \"totalSeconds\",\r\n      ],\r\n      (data) => {\r\n        dataDispatch({\r\n          type: \"USER_INITIALIZE\",\r\n          time:\r\n            data.startedRecordingAt === null // check if a recording is in progress\r\n              ? data.savedTime === null\r\n                ? null\r\n                : data.savedTime\r\n              : null,\r\n          start: data.start,\r\n          current: data.progress,\r\n          end: data.end,\r\n          total: data.totalSeconds,\r\n        });\r\n        setUserName(data.userName);\r\n        isInInitialization.current = false;\r\n      }\r\n    );\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    // update variables in a debounced way (to avoid going over the 1800 MAX_WRITE_OPERATIONS / hr)\r\n    let delayedUpdate;\r\n    if (!isInInitialization.current) {\r\n      // don't write back values on first initializating\r\n\r\n      if (\r\n        dataState.end === dataState.current &&\r\n        dataState.end !== dataState.start\r\n      ) {\r\n        playFile(\"sounds/complete.mp3\");\r\n        chrome.storage.sync.get([\"startedRecordingAt\"], (data) => {\r\n          dataDispatch({\r\n            type: \"TIME_PAUSE\",\r\n            value: data.startedRecordingAt,\r\n          });\r\n        });\r\n      } else if (\r\n        dataState.start !== dataState.current &&\r\n        dataState.end !== dataState.start\r\n      ) {\r\n        playFile(\"sounds/increment.mp3\");\r\n      }\r\n\r\n      delayedUpdate = setTimeout(() => {\r\n        chrome.storage.sync.set(\r\n          {\r\n            start: dataState.start,\r\n            progress: dataState.current,\r\n            end: dataState.end,\r\n          },\r\n          () => {\r\n            setIsBuffering(false);\r\n          }\r\n        );\r\n      }, 2000); // add buffering\r\n      setIsBuffering(true);\r\n    }\r\n    return () => {\r\n      clearTimeout(delayedUpdate);\r\n    };\r\n  }, [dataState.start, dataState.current, dataState.end]);\r\n\r\n  const timeAddHandler = () => {\r\n    if (dataState.timerID !== false) {\r\n      alert(\"Can't proceed while timer is active.\");\r\n      return;\r\n    }\r\n\r\n    let x = prompt(\r\n      \"Enter amount of time to load in the following format: h:mm:ss\"\r\n    );\r\n\r\n    if (x !== undefined && x !== null) {\r\n      let timeArr = x?.split(\":\").reverse();\r\n\r\n      if (timeArr?.length !== 3) {\r\n        alert(\"Invalid input! Too many or too few fields were input.\");\r\n        return;\r\n      }\r\n\r\n      if (\r\n        !Number.isInteger(+timeArr[0]) ||\r\n        !Number.isInteger(+timeArr[1]) ||\r\n        !Number.isInteger(+timeArr[2])\r\n      ) {\r\n        alert(\"Invalid input! All fields must be integers.\");\r\n        return;\r\n      }\r\n\r\n      //All checks passed, now we're diving in to the addition.\r\n      let desiredTimeInSeconds =\r\n        +timeArr[0] + +timeArr[1] * 60 + +timeArr[2] * 3600;\r\n\r\n      dataDispatch({ type: \"USER_ADDTIME\", value: desiredTimeInSeconds });\r\n    }\r\n  };\r\n\r\n  const nameChangeHandler = () => {\r\n    let newUserName = prompt(\"Please choose your nickname:\")?.trim();\r\n\r\n    if (newUserName?.length === 0) {\r\n      alert(\"Invalid input! Name must contain at least one charachter.\");\r\n    } else if (newUserName !== undefined && newUserName !== null) {\r\n      setUserName(newUserName);\r\n      chrome.storage.sync.set({\r\n        userName: newUserName,\r\n      });\r\n    }\r\n  };\r\n\r\n  const tickHandler = () => {\r\n    if (isBufferingRef.current === false) {\r\n      chrome.storage.sync.get(\r\n        [\"start\", \"progress\", \"end\", \"totalSeconds\", \"startedRecordingAt\"],\r\n        (data) => {\r\n          dataDispatch({\r\n            type: \"DATA_REFRESH\",\r\n            start: data.start,\r\n            progress: data.progress,\r\n            end: data.end,\r\n            totalSeconds: data.totalSeconds,\r\n          });\r\n          setTimeToShow(\r\n            (Date.now() - data.startedRecordingAt) / 1000 // add 1 second to account for delay\r\n          );\r\n        }\r\n      );\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div id=\"popup-container\" className=\"Card\">\r\n      <div className=\"Card-header\">\r\n        <a onClick={nameChangeHandler} className=\"headline\">\r\n          <b>{getUserName}</b>\r\n        </a>\r\n        <a onClick={timeAddHandler} className=\"mode\">\r\n          Import Time\r\n        </a>\r\n      </div>\r\n\r\n      <div className=\"Card-layout\">\r\n        <div className=\"stats seperated datasection\">\r\n          <div>\r\n            <b>Stats</b>\r\n          </div>\r\n          <div>\r\n            You have in total <b>{Math.round(dataState.total / 3600)}</b>{\" \"}\r\n            recorded hours.\r\n          </div>\r\n        </div>\r\n        <div className=\"initialize-data seperated datasection\">\r\n          <div className=\"data-row\">\r\n            <div>Start</div>\r\n            <NumberInput\r\n              min={0}\r\n              className=\"data-input\"\r\n              placeholder=\"0\"\r\n              onChange={(event) => {\r\n                dataDispatch({\r\n                  type: \"START_CHANGE\",\r\n                  value: event.target.value,\r\n                });\r\n              }}\r\n              value={+dataState.start === 0 ? \"\" : dataState.start}\r\n            />\r\n          </div>\r\n          <div className=\"data-row\">\r\n            <div>Progress</div>\r\n            <NumberInput\r\n              className=\"data-input\"\r\n              placeholder=\"0\"\r\n              onChange={(event) => {\r\n                dataDispatch({\r\n                  type: \"CURRENT_CHANGE\",\r\n                  value: event.target.value,\r\n                });\r\n              }}\r\n              value={+dataState.current === 0 ? \"\" : dataState.current}\r\n            />\r\n          </div>\r\n          <div className=\"data-row\">\r\n            <div>Finish</div>\r\n            <NumberInput\r\n              className=\"data-input\"\r\n              placeholder=\"0\"\r\n              onChange={(event) => {\r\n                dataDispatch({ type: \"END_CHANGE\", value: event.target.value });\r\n              }}\r\n              value={+dataState.end === 0 ? \"\" : dataState.end}\r\n            />\r\n          </div>\r\n        </div>\r\n        <div\r\n          className={\r\n            \"actions datasection\" +\r\n            (dataState.end > dataState.start ? \" button-seperated\" : \"\")\r\n          }\r\n        >\r\n          {/* <div>Actions</div> */}\r\n          <div className=\"buttons-container\">\r\n            <button\r\n              onClick={() => dataDispatch({ type: \"TIME_RESET\" })}\r\n              onDoubleClick={() => dataDispatch({ type: \"FULL_RESET\" })}\r\n            >\r\n              Reset\r\n            </button>\r\n            <BufferElement\r\n              isActive={isBuffering}\r\n              isInitializing={isInInitialization}\r\n              timeDisplay={\r\n                timeToShow !== false ? beautify(timeToShow) : timeToShow\r\n              }\r\n            />\r\n            <Timer\r\n              autoFocus={true}\r\n              timerID={dataState.timerID}\r\n              modifyTimerID={(newID) => {\r\n                dataDispatch({ type: \"MODIFY_TIMERID\", value: newID });\r\n              }}\r\n              onTick={tickHandler}\r\n              onPause={() =>\r\n                chrome.storage.sync.get([\"startedRecordingAt\"], (data) => {\r\n                  dataDispatch({\r\n                    type: \"TIME_PAUSE\",\r\n                    value: data.startedRecordingAt,\r\n                  });\r\n                })\r\n              }\r\n            />\r\n          </div>\r\n        </div>\r\n        {dataState.end > dataState.start ? (\r\n          <div className=\"progress-section prog-actions\">\r\n            <AnimatedProgressBar\r\n              progress={\r\n                dataState.end - dataState.start === 0\r\n                  ? 0\r\n                  : (dataState.current - dataState.start) /\r\n                    (dataState.end - dataState.start)\r\n              }\r\n            />\r\n          </div>\r\n        ) : (\r\n          false\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}